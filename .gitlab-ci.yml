stages:
  - build

build_job:
  stage: build
  tags:
    - gitlab-com-saas-windows-medium-amd64
  script:
    - echo "Step 1: Cleaning up existing Python versions..."
    # We use --force to ensure we clear out the pre-installed 3.13
    - choco uninstall python python3 -y --continue-on-error

    - echo "Step 2: Installing Python 3.12.0..."
    - choco install python --version=3.12.0 -y --allow-downgrade --no-progress

    - echo "Step 3: Refreshing Environment Variables..."
    # This is critical on Windows to update the PATH in the current session
    - $env:Path = [System.Environment]::GetEnvironmentVariable("Path","Machine") + ";" + [System.Environment]::GetEnvironmentVariable("Path","User")

    - echo "Step 4: Verifying Python Version..."
    - python --version
    - where.exe python

    - echo "Step 5: Installing Nuitka and dependencies..."
    - python -m pip install --upgrade pip
    - python -m pip install nuitka
    # Add your project dependencies here, e.g.:
    # - python -m pip install -r requirements.txt

    - echo "Step 6: Running Nuitka Build..."
    # Using 'python -m nuitka' is safer than calling 'nuitka' directly
    - python -m nuitka --standalone --onefile your_script.py

  artifacts:
    paths:
      - "*.exe"
    expire_in: 1 week