stages:
  - build

build_job:
  stage: build
  tags:
    - gitlab-com-saas-windows-medium-amd64
  script:
    - "echo 'Step 1: Cleaning up existing Python versions...'"
    - "choco uninstall python python3 -y --continue-on-error"

    - "echo 'Step 2: Installing Python 3.12.0...'"
    - "choco install python --version=3.12.0 -y --allow-downgrade --no-progress"

    - "echo 'Step 3: Updating Environment Path...'"
    # We use double quotes around the whole command to prevent YAML syntax errors
    - "$env:Path = [System.Environment]::GetEnvironmentVariable('Path','Machine') + ';' + [System.Environment]::GetEnvironmentVariable('Path','User')"

    - "echo 'Step 4: Verifying Python Version...'"
    - "python --version"

    - "echo 'Step 5: Installing Nuitka...'"
    - "python -m pip install --upgrade pip"
    - "python -m pip install nuitka"

    - "echo 'Step 6: Running Nuitka Build...'"
    - "python -m nuitka --standalone --onefile main.py"

  artifacts:
    paths:
      - "*.exe"
    expire_in: 1 week