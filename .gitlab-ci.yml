stages:
  - build

build_job:
  stage: build
  tags:
    - saas-windows-medium-amd64
  script:
    - "echo 'Step 1: Setting up Python 3.12.0...'"
    - "choco install python --version=3.12.0 -y --allow-downgrade --no-progress"

    - "echo 'Step 2: Refreshing Path...'"
    - "$env:Path = [System.Environment]::GetEnvironmentVariable('Path','Machine') + ';' + [System.Environment]::GetEnvironmentVariable('Path','User')"

    - "echo 'Step 3: Installing Libraries (CRITICAL)...'"
    - "python -m pip install --upgrade pip"
    - "python -m pip install nuitka"
    # ADD EVERY LIBRARY YOU IMPORT IN YOUR SCRIPT HERE:
    # Example: - "python -m pip install Pillow pynput mss"
    - "python -m pip install Pillow"

    - "echo 'Step 4: Compiling Click!.py...'"
    # Added --follow-imports to ensure it doesn't leave anything behind
    - 'python -m nuitka --standalone --onefile --windows-console-mode=disable --enable-plugin=tk-inter --follow-imports --assume-yes-for-downloads "Click!.py"'

  artifacts:
    paths:
      - "Click!.dist/Click!.exe"
      - "*.exe"
    expire_in: 1 week