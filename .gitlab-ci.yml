stages:
  - build

build_job:
  stage: build
  tags:
    - saas-windows-medium-amd64
  script:
    - "echo 'Step 1: Downgrading Python to 3.12.0...'"
    - "choco install python --version=3.12.0 -y --allow-downgrade --no-progress"

    - "echo 'Step 2: Refreshing Environment Path...'"
    - "$env:Path = [System.Environment]::GetEnvironmentVariable('Path','Machine') + ';' + [System.Environment]::GetEnvironmentVariable('Path','User')"

    - "echo 'Step 3: Installing Requirements...'"
    - "python -m pip install --upgrade pip"
    - "python -m pip install nuitka"
    # Matches your imports: customtkinter, Pillow (PIL), and python-docx
    - "python -m pip install customtkinter Pillow python-docx"

    - "echo 'Step 4: Verifying files...'"
    - "dir"

    - "echo 'Step 5: Compiling Click!.py...'"
    # --windows-icon-from-ico: Sets the icon for the .exe file itself
    # --include-data-file: Bundles the icon so the Python code can use it for the window
    # --windows-console-mode=disable: Removes the black background window
    - >
      python -m nuitka 
      --standalone 
      --onefile 
      --windows-console-mode=disable 
      --enable-plugin=tk-inter 
      --assume-yes-for-downloads 
      --windows-icon-from-ico=app_icon.ico 
      --include-data-file=app_icon.ico=app_icon.ico 
      "Click!.py"

  artifacts:
    paths:
      - "Click!.exe"
    expire_in: 1 week